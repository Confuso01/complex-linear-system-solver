<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resolvedor de Sistemas Lineares - N√∫meros Complexos</title>
    <style>
        :root {
            /* Modo Claro */
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --container-bg: white;
            --text-color: #333;
            --text-secondary: #555;
            --text-muted: #666;
            --border-color: #ddd;
            --border-light: #e9ecef;
            --section-bg: #f8f9fa;
            --input-bg: white;
            --shadow-color: rgba(0,0,0,0.1);
            --shadow-light: rgba(0,0,0,0.08);
            --primary-color: #4facfe;
            --primary-gradient-start: #4facfe;
            --primary-gradient-end: #00f2fe;
            --success-bg: #d4edda;
            --success-border: #c3e6cb;
            --success-text: #155724;
            --error-bg: #f8d7da;
            --error-border: #f5c6cb;
            --error-text: #dc3545;
            --modal-overlay: rgba(0,0,0,0.5);
        }

        [data-theme="dark"] {
            /* Modo Noturno */
            --bg-gradient-start: #2c3e50;
            --bg-gradient-end: #34495e;
            --container-bg: #2c3e50;
            --text-color: #ecf0f1;
            --text-secondary: #bdc3c7;
            --text-muted: #95a5a6;
            --border-color: #34495e;
            --border-light: #34495e;
            --section-bg: #34495e;
            --input-bg: #2c3e50;
            --shadow-color: rgba(0,0,0,0.3);
            --shadow-light: rgba(0,0,0,0.2);
            --primary-color: #3498db;
            --primary-gradient-start: #3498db;
            --primary-gradient-end: #2980b9;
            --success-bg: #27ae60;
            --success-border: #229954;
            --success-text: #ecf0f1;
            --error-bg: #e74c3c;
            --error-border: #c0392b;
            --error-text: #ecf0f1;
            --modal-overlay: rgba(0,0,0,0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 15px;
            box-shadow: 0 20px 40px var(--shadow-color);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .content {
            padding: 30px;
        }

        .config-section {
            background: var(--section-bg);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .config-section h3 {
            color: var(--text-color);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .size-control {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .size-control label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .size-control select {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
            background: var(--input-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .size-control select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .help-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .help-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .step-by-step-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(79, 172, 254, 0.1);
            border-radius: 8px;
            border: 1px solid var(--primary-color);
        }

        .step-by-step-control input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .step-by-step-control label {
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer;
        }

        .diagram-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(40, 167, 69, 0.1);
            border-radius: 8px;
            border: 1px solid #28a745;
            flex-wrap: wrap;
        }

        .diagram-controls input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .diagram-controls label {
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer;
        }

        .matrix-section {
            background: var(--container-bg);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px var(--shadow-light);
            transition: all 0.3s ease;
        }

        .matrix-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .matrix-part {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .matrix-part h4 {
            margin-bottom: 15px;
            color: var(--text-color);
            font-size: 1.1em;
        }

        .matrix-grid {
            display: grid;
            gap: 8px;
            padding: 15px;
            background: var(--section-bg);
            border-radius: 8px;
            border: 2px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .matrix-input {
            width: 100px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background: var(--input-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .matrix-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1), 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .matrix-input:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .vector-grid {
            display: grid;
            gap: 8px;
            padding: 15px;
            background: var(--section-bg);
            border-radius: 8px;
            border: 2px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .operator {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 0 10px;
        }

        .variable-label {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 5px;
        }

        [data-theme="dark"] .variable-label {
            background: var(--primary-color);
            color: white;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-save:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .results-section {
            background: var(--container-bg);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px var(--shadow-light);
            transition: all 0.3s ease;
        }

        .results-section h3 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .result-content {
            background: var(--section-bg);
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-light);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .error {
            color: var(--error-text);
            background: var(--error-bg);
            border: 1px solid var(--error-border);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .success {
            color: var(--success-text);
            background: var(--success-bg);
            border: 1px solid var(--success-border);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .help-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-overlay);
        }

        .help-content {
            background-color: var(--container-bg);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px var(--shadow-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .help-content h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .help-content h3 {
            color: var(--text-color);
            margin: 20px 0 10px 0;
        }

        .help-content p, .help-content li {
            line-height: 1.6;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .help-content ul {
            margin-left: 20px;
        }

        .close {
            color: var(--text-muted);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--text-color);
        }

        .system-equations-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background: var(--section-bg);
            border-radius: 8px;
            border: 2px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .equation-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .equation-row input[type="text"] {
            width: 80px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            text-align: center;
            background: var(--input-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .equation-row input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1), 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .equation-row input[type="text"]:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .equation-row .equals-sign {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .equation-row .variable-label {
            background: #e3f2fd;
            padding: 5px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #1976d2;
        }

        .step-by-step-results {
            background: var(--section-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-light);
            display: none;
        }

        .step-by-step-results h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .step-by-step-results .step {
            margin-bottom: 15px;
            padding: 10px;
            background: var(--container-bg);
            border-radius: 5px;
            border-left: 3px solid var(--primary-color);
        }

        .step-by-step-results .step-title {
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .step-by-step-results .step-content {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: var(--text-secondary);
            white-space: pre-wrap;
        }

        .diagrams-section {
            background: var(--container-bg);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px var(--shadow-light);
            transition: all 0.3s ease;
            display: none;
        }

        .diagrams-section h3 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #28a745;
            padding-bottom: 10px;
        }

        .diagram-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .diagram-item {
            background: var(--section-bg);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-light);
        }

        .diagram-item h4 {
            color: var(--text-color);
            margin-bottom: 15px;
            text-align: center;
        }

        .diagram-canvas {
            width: 100%;
            height: 300px;
            border-radius: 5px;
        }

        .capture-area {
            background: var(--container-bg);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .matrix-section, .config-section, .results-section, .diagrams-section {
            animation: fadeIn 0.6s ease-out;
        }

        .matrix-input, .equation-row input[type="text"] {
            animation: slideIn 0.4s ease-out;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .matrix-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .operator {
                font-size: 1.5em;
                margin: 10px 0;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .matrix-input {
                width: 80px;
                font-size: 12px;
            }

            .equation-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .equation-row input[type="text"] {
                width: 100%;
            }

            .theme-toggle {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 10px;
            }

            .diagram-container {
                grid-template-columns: 1fr;
            }

            .diagram-controls {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">üåô</button>
            <h1> Resolvedor de Sistemas Lineares</h1>
            <p>Resolu√ß√£o de sistemas com n√∫meros complexos</p>
        </div>

        <div class="content">
            <div class="capture-area" id="captureArea">
                <div class="config-section">
                    <h3>‚öôÔ∏è Configura√ß√£o do Sistema</h3>
                    <div class="size-control">
                        <label for="matrixSize">Tamanho da matriz (n√ón):</label>
                        <select id="matrixSize" onchange="updateMatrixSize()">
                            <option value="2" selected>2√ó2</option>
                            <option value="3">3√ó3</option>
                            <option value="4">4√ó4</option>
                            <option value="5">5√ó5</option>
                            <option value="6">6√ó6</option>
                        </select>
                        <label for="decimalPlaces">Casas decimais:</label>
                        <input type="number" id="decimalPlaces" value="4" min="0" max="40" onchange="updateDecimalPlaces()">
                        <button class="help-btn" onclick="showHelp()">üìñ Ajuda Geral</button>
                    </div>
                    
                    <div class="step-by-step-control">
                        <input type="checkbox" id="showSteps" onchange="toggleStepByStep()">
                        <label for="showSteps">Mostrar passo a passo da resolu√ß√£o</label>
                    </div>

                    <div class="diagram-controls">
                        <input type="checkbox" id="showDiagrams" onchange="toggleDiagrams()">
                        <label for="showDiagrams">Mostrar diagramas visuais</label>
                        
                        <input type="checkbox" id="showPhasor" onchange="updateDiagramVisibility()">
                        <label for="showPhasor">Diagrama Fasorial</label>
                        
                        <input type="checkbox" id="showVector" onchange="updateDiagramVisibility()">
                        <label for="showVector">Diagrama Vetorial</label>
                        
                        <input type="checkbox" id="showPolygonal" onchange="updateDiagramVisibility()">
                        <label for="showPolygonal">Diagrama Poligonal</label>
                    </div>
                </div>

                <div class="input-type-selection config-section">
                    <h3>Escolha o tipo de entrada:</h3>
                    <div class="size-control">
                        <input type="radio" id="inputMatrix" name="inputType" value="matrix" checked onchange="toggleInputType()">
                        <label for="inputMatrix">Entrada por Matriz</label>
                        <input type="radio" id="inputSystem" name="inputType" value="system" onchange="toggleInputType()">
                        <label for="inputSystem">Entrada por Sistema de Equa√ß√µes</label>
                    </div>
                </div>

                <div id="matrixInputSection" class="matrix-section">
                    <h3>üìä Sistema Linear: A √ó x = b</h3>
                    <div id="matrixContainer" class="matrix-container">
                        <!-- Matriz ser√° gerada dinamicamente -->
                    </div>
                </div>

                <div id="systemInputSection" class="matrix-section" style="display:none;">
                    <h3>üìù Entrada por Sistema de Equa√ß√µes</h3>
                    <div id="systemEquationsContainer" class="system-equations-container">
                        <!-- Equa√ß√µes ser√£o geradas dinamicamente -->
                    </div>
                    <p style="margin-top: 15px; font-size: 0.9em; color: var(--text-muted);">Exemplo: 2x + 3y = 10 (use 'j' para imagin√°rio, ex: 2+3j)</p>
                </div>

                <div class="results-section">
                    <h3>üìã Resultados</h3>
                    <div id="results" class="result-content">
Aguardando resolu√ß√£o do sistema...

FORMATOS ACEITOS PARA N√öMEROS COMPLEXOS:

1. FORMATO RETANGULAR (a + bj):
   ‚Ä¢ 3+4j  ‚Üí  3 + 4i     ‚Ä¢ 2-5j  ‚Üí  2 - 5i     ‚Ä¢ -1+3j ‚Üí  -1 + 3i
   ‚Ä¢ 5     ‚Üí  5 + 0i     ‚Ä¢ 2j    ‚Üí  0 + 2i

2. FORMATO FASORIAL (M‚à†Œ∏):
   ‚Ä¢ 5‚à†30   ‚Üí  magnitude 5, √¢ngulo 30¬∞
   ‚Ä¢ 10<45  ‚Üí  magnitude 10, √¢ngulo 45¬∞
   ‚Ä¢ 2ang60 ‚Üí  magnitude 2, √¢ngulo 60¬∞
                    </div>
                    <div id="determinantResult" class="result-content" style="margin-top: 20px;">
                        Aguardando c√°lculo do determinante...
                    </div>
                    
                    <div id="stepByStepResults" class="step-by-step-results">
                        <h4>üîç Passo a Passo da Resolu√ß√£o</h4>
                        <div id="stepByStepContent"></div>
                    </div>
                </div>

                <div id="diagramsSection" class="diagrams-section">
                    <h3>üìà Diagramas Visuais</h3>
                    <div class="diagram-container">
                        <div id="phasorDiagram" class="diagram-item" style="display:none;">
                            <h4>Diagrama Fasorial</h4>
                            <canvas id="phasorCanvas" class="diagram-canvas"></canvas>
                        </div>
                        <div id="vectorDiagram" class="diagram-item" style="display:none;">
                            <h4>Diagrama Vetorial</h4>
                            <canvas id="vectorCanvas" class="diagram-canvas"></canvas>
                        </div>
                        <div id="polygonalDiagram" class="diagram-item" style="display:none;">
                            <h4>Diagrama Poligonal</h4>
                            <canvas id="polygonalCanvas" class="diagram-canvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è Limpar Todos</button>
                <button class="btn btn-primary" onclick="solveSystem()">üöÄ Resolver Sistema</button>
            </div>
        </div>
    </div>

    <!-- Modal de Ajuda -->
    <div id="helpModal" class="help-modal">
        <div class="help-content">
            <span class="close" onclick="closeHelp()">&times;</span>
            <h2>üìö Ajuda - Resolvedor de Sistemas Lineares</h2>
            
            <h3>üéØ O que este programa faz?</h3>
            <p>Este programa resolve sistemas lineares do tipo <strong>Ax = b</strong> onde:</p>
            <ul>
                <li><strong>A</strong> √© uma matriz quadrada n√ón de coeficientes complexos</li>
                <li><strong>b</strong> √© um vetor coluna n√ó1 de termos independentes complexos</li>
                <li><strong>x</strong> √© o vetor solu√ß√£o que queremos encontrar</li>
            </ul>

            <h3>üìù Formatos aceitos para n√∫meros complexos:</h3>
            
            <h4>1. Formato Retangular (a + bj):</h4>
            <ul>
                <li><code>3+4j</code> ‚Üí 3 + 4i</li>
                <li><code>2-5j</code> ‚Üí 2 - 5i</li>
                <li><code>-1+3j</code> ‚Üí -1 + 3i</li>
                <li><code>5</code> ‚Üí 5 + 0i (n√∫mero real)</li>
                <li><code>2j</code> ‚Üí 0 + 2i (imagin√°rio puro)</li>
            </ul>

            <h4>2. Formato Fasorial (M‚à†Œ∏):</h4>
            <ul>
                <li><code>5‚à†30</code> ‚Üí magnitude 5, √¢ngulo 30¬∞</li>
                <li><code>10&lt;45</code> ‚Üí magnitude 10, √¢ngulo 45¬∞</li>
                <li><code>2ang60</code> ‚Üí magnitude 2, √¢ngulo 60¬∞</li>
            </ul>

            <h3>üöÄ Como usar:</h3>
            <ol>
                <li>Escolha o tamanho da matriz (n√ón)</li>
                <li>Marque a op√ß√£o "Mostrar passo a passo" se desejar ver a resolu√ß√£o detalhada</li>
                <li>Marque "Mostrar diagramas visuais" e selecione os tipos de diagrama desejados</li>
                <li>Escolha o tipo de entrada (matriz ou sistema de equa√ß√µes)</li>
                <li>Preencha os elementos da matriz A ou os coeficientes das equa√ß√µes</li>
                <li>Preencha os elementos do vetor b ou os termos independentes</li>
                <li>Clique em "Resolver Sistema"</li>
            </ol>

            <h3>üìä Resultados:</h3>
            <ul>
                <li><strong>Solu√ß√£o:</strong> Valores de x‚ÇÅ, x‚ÇÇ, ..., x‚Çô em formato retangular e fasorial</li>
                <li><strong>Determinante:</strong> Valor do determinante da matriz A</li>
                <li><strong>Verifica√ß√£o:</strong> Confirma√ß√£o da solu√ß√£o substituindo na equa√ß√£o original</li>
                <li><strong>Passo a passo:</strong> Detalhamento do processo de elimina√ß√£o gaussiana</li>
                <li><strong>Diagramas:</strong> Representa√ß√µes visuais dos n√∫meros complexos</li>
            </ul>

            <h3>‚ö†Ô∏è Observa√ß√µes importantes:</h3>
            <ul>
                <li>Use 'j' para representar a unidade imagin√°ria (n√£o 'i')</li>
                <li>N√£o use espa√ßos nos n√∫meros complexos</li>
                <li>Para √¢ngulos fasoriais, use graus (n√£o radianos)</li>
                <li>O sistema deve ter solu√ß√£o √∫nica (determinante ‚â† 0)</li>
            </ul>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let currentMatrixSize = 2;
        let showStepByStep = false;
        let showDiagrams = false;
        let currentSolution = null;
        let decimalPlaces = 4; // Valor padr√£o

        // Fun√ß√£o para atualizar casas decimais
        function updateDecimalPlaces() {
            const input = document.getElementById("decimalPlaces");
            decimalPlaces = parseInt(input.value);
            if (isNaN(decimalPlaces) || decimalPlaces < 0) {
                decimalPlaces = 0; // Garante que seja um n√∫mero n√£o negativo
                input.value = 0;
            }
            // Re-resolver o sistema para aplicar as novas casas decimais, se houver uma solu√ß√£o
            if (currentSolution) {
                solveSystem();
            }
        }

        // Fun√ß√£o para alternar tema
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeToggle.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Carregar tema salvo
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
            } else {
                themeToggle.textContent = 'üåô';
            }
        }

        // Fun√ß√£o para alternar passo a passo
        function toggleStepByStep() {
            showStepByStep = document.getElementById('showSteps').checked;
            const stepByStepResults = document.getElementById('stepByStepResults');
            
            if (!showStepByStep) {
                stepByStepResults.style.display = 'none';
            }
        }

        // Fun√ß√£o para alternar diagramas
        function toggleDiagrams() {
            showDiagrams = document.getElementById('showDiagrams').checked;
            const diagramsSection = document.getElementById('diagramsSection');
            const diagramCheckboxes = ['showPhasor', 'showVector', 'showPolygonal'];
            
            if (showDiagrams) {
                diagramsSection.style.display = 'block';
                diagramCheckboxes.forEach(id => {
                    document.getElementById(id).disabled = false;
                });
            } else {
                diagramsSection.style.display = 'none';
                diagramCheckboxes.forEach(id => {
                    document.getElementById(id).disabled = true;
                    document.getElementById(id).checked = false;
                });
                updateDiagramVisibility();
            }
        }

        // Fun√ß√£o para atualizar visibilidade dos diagramas
        function updateDiagramVisibility() {
            const phasorChecked = document.getElementById('showPhasor').checked;
            const vectorChecked = document.getElementById('showVector').checked;
            const polygonalChecked = document.getElementById('showPolygonal').checked;
            
            document.getElementById('phasorDiagram').style.display = phasorChecked ? 'block' : 'none';
            document.getElementById('vectorDiagram').style.display = vectorChecked ? 'block' : 'none';
            document.getElementById('polygonalDiagram').style.display = polygonalChecked ? 'block' : 'none';
            
            if (currentSolution && (phasorChecked || vectorChecked || polygonalChecked)) {
                generateDiagrams(currentSolution);
            }
        }
        // Fun√ß√£o para alternar entre entrada por matriz e por sistema
        function toggleInputType() {
            const inputMatrix = document.getElementById("inputMatrix").checked;
            document.getElementById("matrixInputSection").style.display = inputMatrix ? "block" : "none";
            document.getElementById("systemInputSection").style.display = inputMatrix ? "none" : "block";
        }

        // Fun√ß√£o para atualizar o tamanho da matriz
        function updateMatrixSize() {
            currentMatrixSize = parseInt(document.getElementById("matrixSize").value);
            generateMatrixInputs();
            generateSystemInputs();
        }

        // Fun√ß√£o para gerar inputs da matriz
        function generateMatrixInputs() {
            const container = document.getElementById("matrixContainer");
            container.innerHTML = "";

            // Matriz A
            const matrixA = document.createElement("div");
            matrixA.className = "matrix-part";
            matrixA.innerHTML = `<h4>Matriz A (${currentMatrixSize}√ó${currentMatrixSize})</h4>`;
            
            const gridA = document.createElement("div");
            gridA.className = "matrix-grid";
            gridA.style.gridTemplateColumns = `repeat(${currentMatrixSize}, 1fr)`;
            
            for (let i = 0; i < currentMatrixSize; i++) {
                for (let j = 0; j < currentMatrixSize; j++) {
                    const input = document.createElement("input");
                    input.type = "text";
                    input.className = "matrix-input";
                    input.id = `a${i}${j}`;
                    input.placeholder = `a${i+1}${j+1}`;
                    gridA.appendChild(input);
                }
            }
            matrixA.appendChild(gridA);

            // Operador de multiplica√ß√£o
            const operator1 = document.createElement("div");
            operator1.className = "operator";
            operator1.textContent = "√ó";

            // Vetor x
            const vectorX = document.createElement("div");
            vectorX.className = "matrix-part";
            vectorX.innerHTML = `<h4>Vetor x</h4>`;
            
            const gridX = document.createElement("div");
            gridX.className = "vector-grid";
            gridX.style.gridTemplateColumns = "1fr";
            
            for (let i = 0; i < currentMatrixSize; i++) {
                const label = document.createElement("div");
                label.className = "variable-label";
                label.textContent = `x${i+1}`;
                gridX.appendChild(label);
            }
            vectorX.appendChild(gridX);

            // Operador de igualdade
            const operator2 = document.createElement("div");
            operator2.className = "operator";
            operator2.textContent = "=";

            // Vetor b
            const vectorB = document.createElement("div");
            vectorB.className = "matrix-part";
            vectorB.innerHTML = `<h4>Vetor b</h4>`;
            
            const gridB = document.createElement("div");
            gridB.className = "vector-grid";
            gridB.style.gridTemplateColumns = "1fr";
            
            for (let i = 0; i < currentMatrixSize; i++) {
                const input = document.createElement("input");
                input.type = "text";
                input.className = "matrix-input";
                input.id = `b${i}`;
                input.placeholder = `b${i+1}`;
                gridB.appendChild(input);
            }
            vectorB.appendChild(gridB);

            container.appendChild(matrixA);
            container.appendChild(operator1);
            container.appendChild(vectorX);
            container.appendChild(operator2);
            container.appendChild(vectorB);
        }

        // Fun√ß√£o para gerar inputs do sistema de equa√ß√µes
        function generateSystemInputs() {
            const container = document.getElementById("systemEquationsContainer");
            container.innerHTML = "";

            for (let i = 0; i < currentMatrixSize; i++) {
                const row = document.createElement("div");
                row.className = "equation-row";

                for (let j = 0; j < currentMatrixSize; j++) {
                    if (j > 0) {
                        const sign = document.createElement("span");
                        sign.textContent = "+";
                        sign.style.margin = "0 5px";
                        row.appendChild(sign);
                    }

                    const input = document.createElement("input");
                    input.type = "text";
                    input.id = `sys_a${i}${j}`;
                    input.placeholder = "coef";
                    row.appendChild(input);

                    const variable = document.createElement("span");
                    variable.className = "variable-label";
                    variable.textContent = `x${j+1}`;
                    variable.style.margin = "0 5px";
                    row.appendChild(variable);
                }

                const equals = document.createElement("span");
                equals.className = "equals-sign";
                equals.textContent = "=";
                row.appendChild(equals);

                const bInput = document.createElement("input");
                bInput.type = "text";
                bInput.id = `sys_b${i}`;
                bInput.placeholder = "termo";
                row.appendChild(bInput);

                container.appendChild(row);
            }
        }

        // Fun√ß√£o para limpar todos os campos
        function clearAll() {
            const inputs = document.querySelectorAll('input[type="text"]');
            inputs.forEach(input => input.value = "");
            document.getElementById("results").textContent = "Aguardando resolu√ß√£o do sistema...";
            document.getElementById("determinantResult").textContent = "Aguardando c√°lculo do determinante...";
            document.getElementById('stepByStepResults').style.display = 'none';
            document.getElementById('diagramsSection').style.display = 'none';
            document.getElementById('showDiagrams').checked = false;
            document.getElementById('showPhasor').checked = false;
            document.getElementById('showVector').checked = false;
            document.getElementById('showPolygonal').checked = false;
            currentSolution = null;
            showDiagrams = false;
        }

        // Fun√ß√£o para mostrar ajuda
        function showHelp() {
            document.getElementById("helpModal").style.display = "block";
        }

        // Fun√ß√£o para fechar ajuda
        function closeHelp() {
            document.getElementById("helpModal").style.display = "none";
        }

        // Fechar modal clicando fora
        window.onclick = function(event) {
            const modal = document.getElementById("helpModal");
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Classe para n√∫meros complexos
        class Complex {
            constructor(real = 0, imag = 0) {
                this.real = real;
                this.imag = imag;
            }

            static fromString(str) {
                if (!str || str.trim() === "") return new Complex(0, 0);
                
                str = str.trim().replace(/\s+/g, '');
                
                // Formato fasorial: magnitude‚à†angle, magnitude<angle, ou magnitudeangangle
                const polarMatch = str.match(/^([+-]?\d*\.?\d+)(?:[‚à†<]|ang)([+-]?\d*\.?\d+)$/);
                if (polarMatch) {
                    const magnitude = parseFloat(polarMatch[1]);
                    const angleInDegrees = parseFloat(polarMatch[2]);
                    const angleInRadians = angleInDegrees * Math.PI / 180;
                    return new Complex(
                        magnitude * Math.cos(angleInRadians),
                        magnitude * Math.sin(angleInRadians)
                    );
                }

                // Formato retangular
                if (str === 'j' || str === '+j') return new Complex(0, 1);
                if (str === '-j') return new Complex(0, -1);
                
                const imagOnlyMatch = str.match(/^([+-]?\d*\.?\d*)j$/);
                if (imagOnlyMatch) {
                    const imagPart = imagOnlyMatch[1];
                    if (imagPart === '' || imagPart === '+') return new Complex(0, 1);
                    if (imagPart === '-') return new Complex(0, -1);
                    return new Complex(0, parseFloat(imagPart));
                }

                const complexMatch = str.match(/^([+-]?\d*\.?\d+)([+-]\d*\.?\d*)j$/);
                if (complexMatch) {
                    const realPart = parseFloat(complexMatch[1]);
                    let imagPart = complexMatch[2];
                    if (imagPart === '+') imagPart = '+1';
                    if (imagPart === '-') imagPart = '-1';
                    return new Complex(realPart, parseFloat(imagPart));
                }

                const realMatch = str.match(/^([+-]?\d*\.?\d+)$/);
                if (realMatch) {
                    return new Complex(parseFloat(realMatch[1]), 0);
                }

                throw new Error(`Formato inv√°lido: ${str}`);
            }

            add(other) {
                return new Complex(this.real + other.real, this.imag + other.imag);
            }

            subtract(other) {
                return new Complex(this.real - other.real, this.imag - other.imag);
            }

            multiply(other) {
                return new Complex(
                    this.real * other.real - this.imag * other.imag,
                    this.real * other.imag + this.imag * other.real
                );
            }

            divide(other) {
                const denominator = other.real * other.real + other.imag * other.imag;
                if (Math.abs(denominator) < 1e-10) {
                    throw new Error("Divis√£o por zero");
                }
                return new Complex(
                    (this.real * other.real + this.imag * other.imag) / denominator,
                    (this.imag * other.real - this.real * other.imag) / denominator
                );
            }

            magnitude() {
                return Math.sqrt(this.real * this.real + this.imag * this.imag);
            }

            phase() {
                return Math.atan2(this.imag, this.real) * 180 / Math.PI;
            }

            toString() {
                const fixedReal = this.real.toFixed(decimalPlaces);
                const fixedImag = this.imag.toFixed(decimalPlaces);

                if (Math.abs(this.imag) < 1e-10) {
                    return fixedReal.replace(/\.?0+$/, "");
                }
                if (Math.abs(this.real) < 1e-10) {
                    if (Math.abs(this.imag - 1) < 1e-10) return 'j';
                    if (Math.abs(this.imag + 1) < 1e-10) return '-j';
                    return `${fixedImag.replace(/\.?0+$/, "")}j`;
                }
                
                const realStr = fixedReal.replace(/\.?0+$/, "");
                const imagStr = Math.abs(this.imag).toFixed(decimalPlaces).replace(/\.?0+$/, "");
                const sign = this.imag >= 0 ? '+' : '-';
                
                if (Math.abs(Math.abs(this.imag) - 1) < 1e-10) {
                    return `${realStr}${sign}j`;
                }
                return `${realStr}${sign}${imagStr}j`;
            }

            toPolar() {
                const mag = this.magnitude();
                const phase = this.phase();
                return `${mag.toFixed(decimalPlaces).replace(/\.?0+$/, "")}‚à†${phase.toFixed(decimalPlaces).replace(/\.?0+$/, "")}¬∞`;
            }
        }

        // Classe para matriz complexa
        class ComplexMatrix {
            constructor(rows, cols) {
                this.rows = rows;
                this.cols = cols;
                this.data = Array(rows).fill().map(() => Array(cols).fill().map(() => new Complex()));
            }

            set(i, j, value) {
                this.data[i][j] = value;
            }

            get(i, j) {
                return this.data[i][j];
            }

            copy() {
                const result = new ComplexMatrix(this.rows, this.cols);
                for (let i = 0; i < this.rows; i++) {
                    for (let j = 0; j < this.cols; j++) {
                        result.set(i, j, new Complex(this.get(i, j).real, this.get(i, j).imag));
                    }
                }
                return result;
            }

            toString() {
                let result = "";
                for (let i = 0; i < this.rows; i++) {
                    result += "[ ";
                    for (let j = 0; j < this.cols; j++) {
                        result += this.get(i, j).toString().padEnd(15);
                        if (j < this.cols - 1) result += " ";
                    }
                    result += " ]\n";
                }
                return result;
            }

            // Fun√ß√£o para calcular o determinante usando expans√£o por cofatores
            determinant() {
                if (this.rows !== this.cols) {
                    throw new Error("Determinante s√≥ pode ser calculado para matrizes quadradas");
                }
                
                const n = this.rows;
                
                // Caso base: matriz 1x1
                if (n === 1) {
                    return this.get(0, 0);
                }
                
                // Caso base: matriz 2x2
                if (n === 2) {
                    return this.get(0, 0).multiply(this.get(1, 1)).subtract(
                           this.get(0, 1).multiply(this.get(1, 0)));
                }
                
                // Para matrizes maiores, usar expans√£o por cofatores na primeira linha
                let det = new Complex(0, 0);
                
                for (let j = 0; j < n; j++) {
                    // Criar submatriz removendo linha 0 e coluna j
                    const subMatrix = new ComplexMatrix(n - 1, n - 1);
                    for (let i = 1; i < n; i++) {
                        let colIndex = 0;
                        for (let k = 0; k < n; k++) {
                            if (k !== j) {
                                subMatrix.set(i - 1, colIndex, this.get(i, k));
                                colIndex++;
                            }
                        }
                    }
                    
                    // Calcular cofator
                    const cofactor = subMatrix.determinant();
                    const sign = (j % 2 === 0) ? 1 : -1;
                    const signedCofactor = cofactor.multiply(new Complex(sign, 0));
                    
                    // Adicionar ao determinante
                    det = det.add(this.get(0, j).multiply(signedCofactor));
                }
                
                return det;
            }
        }

        // Fun√ß√£o para resolver sistema usando elimina√ß√£o gaussiana com pivotamento
        function gaussianElimination(A, b) {
            const n = A.rows;
            const augmented = new ComplexMatrix(n, n + 1);
            const steps = [];
            
            // Criar matriz aumentada
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    augmented.set(i, j, A.get(i, j));
                }
                augmented.set(i, n, b.get(i, 0));
            }

            if (showStepByStep) {
                steps.push({
                    title: "Matriz Aumentada Inicial",
                    content: `[A|b] =\n${augmented.toString()}`
                });
            }

            // Elimina√ß√£o para frente com pivotamento parcial
            for (let k = 0; k < n - 1; k++) {
                // Encontrar o piv√¥
                let maxRow = k;
                for (let i = k + 1; i < n; i++) {
                    if (augmented.get(i, k).magnitude() > augmented.get(maxRow, k).magnitude()) {
                        maxRow = i;
                    }
                }

                // Trocar linhas se necess√°rio
                if (maxRow !== k) {
                    for (let j = 0; j < n + 1; j++) {
                        const temp = augmented.get(k, j);
                        augmented.set(k, j, augmented.get(maxRow, j));
                        augmented.set(maxRow, j, temp);
                    }
                    
                    if (showStepByStep) {
                        steps.push({
                            title: `Troca de linhas L${k+1} ‚Üî L${maxRow+1}`,
                            content: augmented.toString()
                        });
                    }
                }

                // Verificar se o piv√¥ √© zero
                if (augmented.get(k, k).magnitude() < 1e-10) {
                    throw new Error("Sistema singular ou indeterminado");
                }

                // Elimina√ß√£o
                for (let i = k + 1; i < n; i++) {
                    const factor = augmented.get(i, k).divide(augmented.get(k, k));
                    
                    for (let j = k; j < n + 1; j++) {
                        const newValue = augmented.get(i, j).subtract(factor.multiply(augmented.get(k, j)));
                        augmented.set(i, j, newValue);
                    }
                    
                    if (showStepByStep) {
                        steps.push({
                            title: `Elimina√ß√£o: L${i+1} = L${i+1} - (${factor.toString()}) √ó L${k+1}`,
                            content: augmented.toString()
                        });
                    }
                }
            }

            // Verificar se a √∫ltima linha tem piv√¥ v√°lido
            if (augmented.get(n-1, n-1).magnitude() < 1e-10) {
                throw new Error("Sistema singular ou indeterminado");
            }

            // Substitui√ß√£o para tr√°s
            const x = new ComplexMatrix(n, 1);
            
            for (let i = n - 1; i >= 0; i--) {
                let sum = new Complex(0, 0);
                for (let j = i + 1; j < n; j++) {
                    sum = sum.add(augmented.get(i, j).multiply(x.get(j, 0)));
                }
                const result = augmented.get(i, n).subtract(sum).divide(augmented.get(i, i));
                x.set(i, 0, result);
                
                if (showStepByStep) {
                    steps.push({
                        title: `Substitui√ß√£o: x${i+1} = (${augmented.get(i, n).toString()} - soma) / ${augmented.get(i, i).toString()}`,
                        content: `x${i+1} = ${result.toString()}`
                    });
                }
            }

            return { solution: x, steps: steps };
        }

        // Fun√ß√£o para gerar diagramas
        function generateDiagrams(solution) {
            const complexNumbers = [];
            for (let i = 0; i < currentMatrixSize; i++) {
                complexNumbers.push(solution.get(i, 0));
            }

            if (document.getElementById('showPhasor').checked) {
                drawPhasorDiagram(complexNumbers);
            }
            if (document.getElementById('showVector').checked) {
                drawVectorDiagram(complexNumbers);
            }
            if (document.getElementById('showPolygonal').checked) {
                drawPolygonalDiagram(complexNumbers);
            }
        }

        // Fun√ß√£o para desenhar diagrama fasorial
        function drawPhasorDiagram(complexNumbers) {
            const canvas = document.getElementById('phasorCanvas');
            const ctx = canvas.getContext('2d');
            
            // Configurar canvas
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = Math.min(canvas.width, canvas.height) / 4;
            
            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar eixos
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
            ctx.lineWidth = 1;
            
            // Eixo real
            ctx.beginPath();
            ctx.moveTo(20, centerY);
            ctx.lineTo(canvas.width - 20, centerY);
            ctx.stroke();
            
            // Eixo imagin√°rio
            ctx.beginPath();
            ctx.moveTo(centerX, 20);
            ctx.lineTo(centerX, canvas.height - 20);
            ctx.stroke();
            
            // Desenhar fasores
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];
            
            complexNumbers.forEach((complex, index) => {
                const x = centerX + complex.real * scale;
                const y = centerY - complex.imag * scale;
                
                ctx.strokeStyle = colors[index % colors.length];
                ctx.lineWidth = 3;
                
                // Desenhar linha do fasor
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // Desenhar ponto
                ctx.fillStyle = colors[index % colors.length];
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                // Desenhar r√≥tulo
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
                ctx.font = '12px Arial';
                ctx.fillText(`x${index + 1}`, x + 8, y - 8);
            });
            
            // R√≥tulos dos eixos
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            ctx.font = '14px Arial';
            ctx.fillText('Real', canvas.width - 40, centerY - 10);
            ctx.fillText('Imag', centerX + 10, 30);
        }

        // Fun√ß√£o para desenhar diagrama vetorial
        function drawVectorDiagram(complexNumbers) {
            const canvas = document.getElementById('vectorCanvas');
            const ctx = canvas.getContext('2d');
            
            // Configurar canvas
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = Math.min(canvas.width, canvas.height) / 4;
            
            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar grade
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--border-light');
            ctx.lineWidth = 0.5;
            
            for (let i = -2; i <= 2; i++) {
                if (i !== 0) {
                    // Linhas verticais
                    ctx.beginPath();
                    ctx.moveTo(centerX + i * scale, 20);
                    ctx.lineTo(centerX + i * scale, canvas.height - 20);
                    ctx.stroke();
                    
                    // Linhas horizontais
                    ctx.beginPath();
                    ctx.moveTo(20, centerY + i * scale);
                    ctx.lineTo(canvas.width - 20, centerY + i * scale);
                    ctx.stroke();
                }
            }
            
            // Desenhar eixos principais
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(20, centerY);
            ctx.lineTo(canvas.width - 20, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX, 20);
            ctx.lineTo(centerX, canvas.height - 20);
            ctx.stroke();
            
            // Desenhar vetores
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'];
            
            complexNumbers.forEach((complex, index) => {
                const x = centerX + complex.real * scale;
                const y = centerY - complex.imag * scale;
                
                ctx.strokeStyle = colors[index % colors.length];
                ctx.fillStyle = colors[index % colors.length];
                ctx.lineWidth = 3;
                
                // Desenhar vetor
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // Desenhar seta
                const angle = Math.atan2(y - centerY, x - centerX);
                const arrowLength = 15;
                const arrowAngle = Math.PI / 6;
                
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(x - arrowLength * Math.cos(angle - arrowAngle), y - arrowLength * Math.sin(angle - arrowAngle));
                ctx.moveTo(x, y);
                ctx.lineTo(x - arrowLength * Math.cos(angle + arrowAngle), y - arrowLength * Math.sin(angle + arrowAngle));
                ctx.stroke();
                
                // R√≥tulo
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
                ctx.font = '12px Arial';
                ctx.fillText(`x${index + 1}`, x + 8, y - 8);
            });
        }

        // Fun√ß√£o para desenhar diagrama poligonal
        function drawPolygonalDiagram(complexNumbers) {
            const canvas = document.getElementById('polygonalCanvas');
            const ctx = canvas.getContext('2d');
            
            // Configurar canvas
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = Math.min(canvas.width, canvas.height) / 6;
            
            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar eixos
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(20, centerY);
            ctx.lineTo(canvas.width - 20, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX, 20);
            ctx.lineTo(centerX, canvas.height - 20);
            ctx.stroke();
            
            // Calcular pontos do pol√≠gono (soma vetorial)
            let currentX = centerX;
            let currentY = centerY;
            const points = [{x: currentX, y: currentY}];
            
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'];
            
            // Desenhar cada vetor na sequ√™ncia
            complexNumbers.forEach((complex, index) => {
                const nextX = currentX + complex.real * scale;
                const nextY = currentY - complex.imag * scale;
                
                ctx.strokeStyle = colors[index % colors.length];
                ctx.lineWidth = 3;
                
                // Desenhar vetor
                ctx.beginPath();
                ctx.moveTo(currentX, currentY);
                ctx.lineTo(nextX, nextY);
                ctx.stroke();
                
                // Desenhar seta
                const angle = Math.atan2(nextY - currentY, nextX - currentX);
                const arrowLength = 12;
                const arrowAngle = Math.PI / 6;
                
                ctx.beginPath();
                ctx.moveTo(nextX, nextY);
                ctx.lineTo(nextX - arrowLength * Math.cos(angle - arrowAngle), nextY - arrowLength * Math.sin(angle - arrowAngle));
                ctx.moveTo(nextX, nextY);
                ctx.lineTo(nextX - arrowLength * Math.cos(angle + arrowAngle), nextY - arrowLength * Math.sin(angle + arrowAngle));
                ctx.stroke();
                
                // R√≥tulo
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
                ctx.font = '12px Arial';
                const midX = (currentX + nextX) / 2;
                const midY = (currentY + nextY) / 2;
                ctx.fillText(`x${index + 1}`, midX + 5, midY - 5);
                
                points.push({x: nextX, y: nextY});
                currentX = nextX;
                currentY = nextY;
            });
            
            // Desenhar linha de resultado (do in√≠cio ao fim)
            ctx.strokeStyle = '#34495e';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            
            ctx.setLineDash([]);
            
            // Marcar pontos
            points.forEach((point, index) => {
                ctx.fillStyle = index === 0 ? '#2c3e50' : (index === points.length - 1 ? '#e74c3c' : '#3498db');
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // R√≥tulo do resultado
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            ctx.font = '14px Arial';
            ctx.fillText('Soma', currentX + 8, currentY + 8);
        }

        // Fun√ß√£o principal para resolver o sistema
        function solveSystem() {
            try {
                const inputMatrix = document.getElementById("inputMatrix").checked;
                const A = new ComplexMatrix(currentMatrixSize, currentMatrixSize);
                const b = new ComplexMatrix(currentMatrixSize, 1);

                // Ler dados da interface
                if (inputMatrix) {
                    // Entrada por matriz
                    for (let i = 0; i < currentMatrixSize; i++) {
                        for (let j = 0; j < currentMatrixSize; j++) {
                            const value = document.getElementById(`a${i}${j}`).value;
                            A.set(i, j, Complex.fromString(value));
                        }
                        const bValue = document.getElementById(`b${i}`).value;
                        b.set(i, 0, Complex.fromString(bValue));
                    }
                } else {
                    // Entrada por sistema de equa√ß√µes
                    for (let i = 0; i < currentMatrixSize; i++) {
                        for (let j = 0; j < currentMatrixSize; j++) {
                            const value = document.getElementById(`sys_a${i}${j}`).value;
                            A.set(i, j, Complex.fromString(value));
                        }
                        const bValue = document.getElementById(`sys_b${i}`).value;
                        b.set(i, 0, Complex.fromString(bValue));
                    }
                }

                // Resolver o sistema
                const result = gaussianElimination(A, b);
                const solution = result.solution;
                currentSolution = solution;

                // Calcular determinante da matriz A
                const determinant = A.determinant();

                // Exibir resultados
                let output = "SOLU√á√ÉO DO SISTEMA LINEAR:\n\n";
                output += "FORMATO RETANGULAR:\n";
                for (let i = 0; i < currentMatrixSize; i++) {
                    output += `x${i+1} = ${solution.get(i, 0).toString()}\n`;
                }

                output += "\nFORMATO FASORIAL:\n";
                for (let i = 0; i < currentMatrixSize; i++) {
                    output += `x${i+1} = ${solution.get(i, 0).toPolar()}\n`;
                }

                // Verifica√ß√£o da solu√ß√£o
                output += "\nVERIFICA√á√ÉO (A √ó x):\n";
                for (let i = 0; i < currentMatrixSize; i++) {
                    let sum = new Complex(0, 0);
                    for (let j = 0; j < currentMatrixSize; j++) {
                        sum = sum.add(A.get(i, j).multiply(solution.get(j, 0)));
                    }
                    output += `Linha ${i+1}: ${sum.toString()} ‚âà ${b.get(i, 0).toString()}\n`;
                }

                document.getElementById("results").textContent = output;
                document.getElementById("results").className = "result-content success";

                // Exibir determinante
                let detOutput = "DETERMINANTE DA MATRIZ A:\n\n";
                detOutput += `det(A) = ${determinant.toString()}\n`;
                detOutput += `det(A) = ${determinant.toPolar()}\n\n`;
                
                // Informa√ß√µes adicionais sobre o determinante
                const detMagnitude = determinant.magnitude();
                if (detMagnitude < 1e-10) {
                    detOutput += "‚ö†Ô∏è  ATEN√á√ÉO: Determinante pr√≥ximo de zero!\n";
                    detOutput += "A matriz √© singular ou quase singular.\n";
                } else {
                    detOutput += "‚úÖ Matriz n√£o-singular (determinante ‚â† 0)\n";
                    detOutput += `Magnitude: ${detMagnitude.toFixed(decimalPlaces)}\n`;
                    detOutput += `Fase: ${determinant.phase().toFixed(decimalPlaces)}¬∞\n`;
                }

                document.getElementById("determinantResult").textContent = detOutput;
                document.getElementById("determinantResult").className = "result-content success";

                // Exibir passo a passo se habilitado
                if (showStepByStep && result.steps.length > 0) {
                    const stepByStepDiv = document.getElementById('stepByStepResults');
                    const stepByStepContent = document.getElementById('stepByStepContent');
                    
                    stepByStepContent.innerHTML = '';
                    
                    result.steps.forEach((step, index) => {
                        const stepDiv = document.createElement('div');
                        stepDiv.className = 'step';
                        
                        const stepTitle = document.createElement('div');
                        stepTitle.className = 'step-title';
                        stepTitle.textContent = `${index + 1}. ${step.title}`;
                        
                        const stepContent = document.createElement('div');
                        stepContent.className = 'step-content';
                        stepContent.textContent = step.content;
                        
                        stepDiv.appendChild(stepTitle);
                        stepDiv.appendChild(stepContent);
                        stepByStepContent.appendChild(stepDiv);
                    });
                    
                    stepByStepDiv.style.display = 'block';
                }

                // Gerar diagramas se habilitado
                if (showDiagrams) {
                    generateDiagrams(solution);
                }

            } catch (error) {
                document.getElementById("results").textContent = `ERRO: ${error.message}`;
                document.getElementById("results").className = "result-content error";
                document.getElementById("determinantResult").textContent = `ERRO: N√£o foi poss√≠vel calcular o determinante - ${error.message}`;
                document.getElementById("determinantResult").className = "result-content error";
                document.getElementById('stepByStepResults').style.display = 'none';
                currentSolution = null;
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            updateMatrixSize();
            
            // Desabilitar checkboxes de diagrama inicialmente
            ['showPhasor', 'showVector', 'showPolygonal'].forEach(id => {
                document.getElementById(id).disabled = true;
            });
        });
    </script>
</body>
</html>

